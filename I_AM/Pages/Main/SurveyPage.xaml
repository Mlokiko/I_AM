<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="I_AM.Pages.Main.SurveyPage"
             Title="Test"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <Grid RowDefinitions="Auto,*,Auto" Padding="16" RowSpacing="16">
        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="8">
            <Label Text="Odpowiedz na pytania"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
            <Label x:Name="ProgressLabel"
                   FontSize="14"
                   TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}" />
        </VerticalStackLayout>

        <!-- Questions -->
        <CollectionView x:Name="QuestionsCollectionView"
                        Grid.Row="1"
                        SelectionMode="Single"
                        SelectionChangedCommand="{Binding QuestionSelectedCommand}"
                        ItemsSource="{Binding Questions}">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <VerticalStackLayout Padding="16" Spacing="12">
                        <!-- Question Text -->
                        <Label Text="{Binding Text}"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                               LineBreakMode="WordWrap" />

                        <!-- Question Description -->
                        <Label Text="{Binding Description}"
                               FontSize="13"
                               TextColor="{AppThemeBinding Light={StaticResource Gray600}, Dark={StaticResource Gray400}}"
                               LineBreakMode="WordWrap"
                               IsVisible="{Binding Description, Converter={StaticResource StringNotNullConverter}}" />

                        <!-- Options for Closed Questions -->
                        <VerticalStackLayout Spacing="8" IsVisible="{Binding IsClosedQuestion}">
                            <CollectionView ItemsSource="{Binding Options}">
                                <CollectionView.ItemTemplate>
                                    <DataTemplate>
                                        <Button Text="{Binding Text, StringFormat='{0} ({1} pkt)'}"
                                                Padding="12"
                                                Margin="0,4"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectOptionCommand}"
                                                CommandParameter="{Binding .}"
                                                Style="{StaticResource QuestionOptionButtonStyle}" />
                                    </DataTemplate>
                                </CollectionView.ItemTemplate>
                            </CollectionView>
                        </VerticalStackLayout>

                        <!-- Text Entry for Open Questions -->
                        <Entry x:Name="OpenAnswerEntry"
                               Placeholder="Wpisz swoja odpowiedz..."
                               PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                               TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                               IsVisible="{Binding IsOpenQuestion}"
                               Margin="0,8" />

                        <BoxView HeightRequest="1"
                                 BackgroundColor="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray700}}"
                                 Margin="0,8" />
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Action Buttons -->
        <VerticalStackLayout Grid.Row="2" Spacing="8">
            <Button x:Name="SubmitButton"
                    Text="Wyslij odpowiedzi"
                    Command="{Binding SubmitAnswersCommand}"
                    Style="{StaticResource PrimaryButtonStyle}" />
            <Button Text="Anuluj"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource SecondaryButtonStyle}" />
        </VerticalStackLayout>
    </Grid>
</ContentPage>