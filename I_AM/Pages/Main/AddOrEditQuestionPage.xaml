<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:I_AM.Converters"
             x:Class="I_AM.Pages.Main.AddOrEditQuestionPage"
             Title="Pytanie"
             Shell.NavBarIsVisible="False"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <local:NumericDecimalConverter x:Key="NumericDecimalConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="16" Spacing="16">
            <!-- Question Text -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Tekst pytania"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                <Entry x:Name="QuestionTextEntry"
                       Placeholder="Wpisz tekst pytania..."
                       PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                       Text="{Binding Question.Text}" />
            </VerticalStackLayout>

            <!-- Question Description -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Opis pytania (opcjonalnie)"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                <Editor x:Name="QuestionDescriptionEditor"
                        Placeholder="Wpisz opis pytania..."
                        PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                        TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                        HeightRequest="80"
                        Text="{Binding Question.Description}" />
            </VerticalStackLayout>

            <!-- Question Type -->
            <VerticalStackLayout Spacing="4">
                <Label Text="Typ pytania"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />
                <Picker x:Name="QuestionTypePicker"
                        Title="Wybierz typ"
                        ItemsSource="{Binding QuestionTypes}"
                        SelectedItem="{Binding SelectedQuestionTypeDisplay}" />
            </VerticalStackLayout>

            <!-- Options for Closed Questions -->
            <VerticalStackLayout x:Name="OptionsPanel" Spacing="8" IsVisible="{Binding IsClosedQuestionVisible}">
                <Label Text="Opcje odpowiedzi"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}" />

                <CollectionView ItemsSource="{Binding Options}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <VerticalStackLayout Padding="12" Spacing="8"
                                               BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Gray900}}"
                                               Margin="0,4">
                                <!-- Option Text -->
                                <Entry Placeholder="Tekst opcji"
                                       PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                                       Text="{Binding Text}" />

                                <!-- Option Points - z Converter -->
                                <Entry Placeholder="Punkty (np. 5.25)"
                                       PlaceholderColor="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray600}}"
                                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"
                                       Keyboard="Decimal"
                                       Text="{Binding Points, Converter={StaticResource NumericDecimalConverter}, Mode=TwoWay}" />

                                <!-- Delete Button -->
                                <Button Text="Usun opcje"
                                        Command="{Binding BindingContext.RemoveOptionCommand, Source={x:Reference OptionsPanel}}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="#f44336" />
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Button Text="Dodaj opcje"
                        Command="{Binding AddOptionCommand}"
                        BackgroundColor="#4CAF50" />
            </VerticalStackLayout>

            <!-- Action Buttons -->
            <VerticalStackLayout Spacing="8" Margin="0,20,0,0">
                <Button x:Name="SaveButton"
                        Text="Zapisz pytanie"
                        Clicked="OnSaveClicked"
                        Style="{StaticResource PrimaryButtonStyle}" />
                <Button Text="Anuluj"
                        Clicked="OnBackClicked"
                        Style="{StaticResource SecondaryButtonStyle}" />
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>